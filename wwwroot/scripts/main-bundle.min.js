!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}({"./bin/DotNetSubject.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DotNetSubject=void 0;t.DotNetSubject=class{constructor(e){this.subject=e}next(e){const t=e?JSON.stringify(e):null;this.subject.invokeMethodAsync("OnNext",t)}complete(){this.subject.invokeMethodAsync("OnCompleted")}error(e){this.subject.invokeMethodAsync("OnCompleted",e)}test(e){this.subject.invokeMethodAsync("Test",JSON.stringify(e))}}},"./bin/main.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i("./bin/player.service.js");window.PlayerService=new n.PlayerService},"./bin/player.service.js":function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerService=void 0;const s=n(i("./node_modules/audio-recorder-polyfill/index.js")),o=i("./bin/DotNetSubject.js");t.PlayerService=class{constructor(){this.maxRecordTime=2e4,this.mediaRecorder=null,this.isLoading=!1,this.isPlaying=!1,this.isRecording=!1,this.audioElement=new Audio,this.canRecord=!0,window.MediaRecorder=s.default}get isBusy(){return this.isPlaying||this.isRecording||this.isLoading}playUrl(e,t){const i=new o.DotNetSubject(e);return this.isLoading=!0,this.audioElement=new Audio(t),this.audioElement.onloadeddata=(()=>{this.isLoading=!1,this.isPlaying=!0}),this.audioElement.onended=(()=>{console.log("play end",t),this.isPlaying=!1,i.next(),i.complete(),this.audioElement=void 0}),this.audioElement.onerror=(e=>{this.isLoading=!1,console.error("Error playing: "+t),i.error("Error playing: "+t),this.isPlaying=!1,this.audioElement=void 0}),console.log("play",t.length),this.audioElement.play(),i}stopPlaying(){try{this.audioElement&&(this.audioElement.pause(),this.audioElement.currentTime=0,this.isPlaying=!1,this.audioElement=void 0)}catch(e){console.error("stopPlaying",e)}}record(e){console.log("Player.recording");const t=new o.DotNetSubject(e);return this.isLoading=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{let i=[];this.mediaRecorder=new window.MediaRecorder(e,{audioBitsPerSecond:64e3,mimeType:"audio/webm"}),this.mediaRecorder.addEventListener("start",e=>{console.log("onstart"),this.isRecording=!0,this.isLoading=!1,this.timer=setTimeout(()=>this.stopRecording(),this.maxRecordTime)}),this.mediaRecorder.addEventListener("dataavailable",e=>{console.log("ondataavailable",e.data),e.data.size>0&&i.push(e.data)}),this.mediaRecorder.addEventListener("stop",n=>{console.log("Player: stop recording"),this.isLoading=!0,e.getTracks().forEach(e=>e.stop());const s=new Blob(i,{type:i[0].type});s.arrayBuffer().then(e=>{t.next({url:URL.createObjectURL(s),type:s.type,blob64:btoa(String.fromCharCode(...new Uint8Array(e)))}),t.complete(),this.isLoading=!1})}),this.mediaRecorder.start(),this.isRecording=!0,this.isLoading=!1},e=>{t.error(e.toString())}),t}stopRecording(){console.log("Player.stopRecording"),this.isRecording=!1,this.timer&&(clearTimeout(this.timer),this.timer=void 0),this.mediaRecorder&&this.mediaRecorder.stop()}}},"./node_modules/audio-recorder-polyfill/index.js":function(e,t,i){"use strict";i.r(t);var n=i("./node_modules/audio-recorder-polyfill/wave-encoder/index.js");let s,o,r=window.AudioContext||window.webkitAudioContext;function a(e){let t=new Event("error");return t.data=new Error("Wrong state for "+e),t}class c{constructor(e){this.stream=e,this.state="inactive",this.em=document.createDocumentFragment(),this.encoder=function(e){let t=e.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,""),i=new Blob([t]);return new Worker(URL.createObjectURL(i))}(c.encoder);let t=this;this.encoder.addEventListener("message",e=>{let i=new Event("dataavailable");i.data=new Blob([e.data],{type:t.mimeType}),t.em.dispatchEvent(i),"inactive"===t.state&&t.em.dispatchEvent(new Event("stop"))})}start(e){if("inactive"!==this.state)return this.em.dispatchEvent(a("start"));this.state="recording",s||(s=new r),this.clone=this.stream.clone(),this.input=s.createMediaStreamSource(this.clone),o||(o=s.createScriptProcessor(2048,1,1));let t=this;t.encoder.postMessage(["init",s.sampleRate]),o.onaudioprocess=function(e){"recording"===t.state&&t.encoder.postMessage(["encode",e.inputBuffer.getChannelData(0)])},this.input.connect(o),o.connect(s.destination),this.em.dispatchEvent(new Event("start")),e&&(this.slicing=setInterval(()=>{"recording"===t.state&&t.requestData()},e))}stop(){return"inactive"===this.state?this.em.dispatchEvent(a("stop")):(this.requestData(),this.state="inactive",this.clone.getTracks().forEach(e=>{e.stop()}),this.input.disconnect(),clearInterval(this.slicing))}pause(){return"recording"!==this.state?this.em.dispatchEvent(a("pause")):(this.state="paused",this.em.dispatchEvent(new Event("pause")))}resume(){return"paused"!==this.state?this.em.dispatchEvent(a("resume")):(this.state="recording",this.em.dispatchEvent(new Event("resume")))}requestData(){return"inactive"===this.state?this.em.dispatchEvent(a("requestData")):this.encoder.postMessage(["dump",s.sampleRate])}addEventListener(...e){this.em.addEventListener(...e)}removeEventListener(...e){this.em.removeEventListener(...e)}dispatchEvent(...e){this.em.dispatchEvent(...e)}}c.prototype.mimeType="audio/wav",c.isTypeSupported=(e=>c.prototype.mimeType===e),c.notSupported=!navigator.mediaDevices||!r,c.encoder=n.default,t.default=c},"./node_modules/audio-recorder-polyfill/wave-encoder/index.js":function(e,t,i){"use strict";i.r(t),t.default=(()=>{let e=2,t=[];onmessage=(i=>{"encode"===i.data[0]?function(i){let n=i.length,s=new Uint8Array(n*e);for(let t=0;t<n;t++){let n=t*e,o=i[t];o>1?o=1:o<-1&&(o=-1),o*=32768,s[n]=o,s[n+1]=o>>8}t.push(s)}(i.data[1]):"dump"===i.data[0]&&function(i){let n=t.length?t[0].length:0,s=t.length*n,o=new Uint8Array(44+s),r=new DataView(o.buffer);r.setUint32(0,1380533830,!1),r.setUint32(4,36+s,!0),r.setUint32(8,1463899717,!1),r.setUint32(12,1718449184,!1),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,i,!0),r.setUint32(28,i*e,!0),r.setUint16(32,e,!0),r.setUint16(34,8*e,!0),r.setUint32(36,1684108385,!1),r.setUint32(40,s,!0);for(let e=0;e<t.length;e++)o.set(t[e],e*n+44);t=[],postMessage(o.buffer,[o.buffer])}(i.data[1])})})},"./src/secret.js":function(e,t){window.firebaseConfig={get:function(){return{apiKey:"AIzaSyBLHFfWW4nYLcsMDhqunFcnsurz0ScRxfk",authDomain:"flashdev-69399.firebaseapp.com",databaseURL:"https://flashdev-69399.firebaseio.com",projectId:"flashdev-69399",storageBucket:"flashdev-69399.appspot.com",messagingSenderId:"297825270138"}}}},"./src/util.js":function(e,t){window.flash={loseFocus:()=>{console.log("loseFocus"),document.activeElement.blur()},firebaseLogin:e=>{console.log("firebaseLogin"),firebase.initializeApp(window.firebaseConfig.get()),console.log("after firebaseConfig"),new firebaseui.auth.AuthUI(firebase.auth()).start("#firebaseui-auth-container",{callbacks:{signInSuccessWithAuthResult:function(t,i){return e.invokeMethodAsync("OnNext",JSON.stringify({uid:t.user.uid})),e.invokeMethodAsync("OnCompleted"),!1}},signInOptions:[firebase.auth.GoogleAuthProvider.PROVIDER_ID,firebase.auth.EmailAuthProvider.PROVIDER_ID]})}}},0:function(e,t,i){i("./src/secret.js"),i("./src/util.js"),e.exports=i("./bin/main.js")}});
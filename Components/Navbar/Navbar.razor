@using FlashCommon
@using System.Reactive.Linq;
@inject IDynamicDB ddb;

<link href="css/Navbar.css" rel="stylesheet" />

<div class="navbar">
    <div class="rowfullcenter">
        <RoundButton Icon="toggle_on" Click="@ToggleDb"></RoundButton>
        <div class="dbname">@DbName</div>
        @LeftContent
    </div>
    <div class="rowfullcenter">
        @MiddleContent
    </div>
    <div class="rowfullcenter">
        @RightContent
    </div>
</div>

@code {
    [Parameter]
    public RenderFragment LeftContent { get; set; }
    [Parameter]
    public RenderFragment MiddleContent { get; set; }
    [Parameter]
    public RenderFragment RightContent { get; set; }

    string DbName;

    protected override Task OnInitializedAsync()
    {
        ddb.CurrentDB.Subscribe(db =>
        {
            DbName = db.Name;
            InvokeAsync(() => StateHasChanged());
        });
        return base.OnInitializedAsync();
    }

    public void ToggleDb()
    {
        ddb.CurrentDB.Take(1).Subscribe(db =>
        {
            DBChange.To(db.Name == DBNames.Azure.ToString() ? DBNames.Firebase : DBNames.Azure);
        });
    }
}
